<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel Periodista - Noticias Ibarra</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        /* ========== ESTILOS DE LOGIN ========== */
        .login-container {
            max-width: 450px;
            margin: 50px auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .login-header {
            background: linear-gradient(135deg, #2D3748 0%, #1A202C 100%);
            color: white;
            padding: 40px 30px;
            text-align: center;
        }

        .login-header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .login-header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .login-form {
            padding: 40px 30px;
        }

        .login-form .form-group {
            margin-bottom: 24px;
        }

        .login-form label {
            display: block;
            margin-bottom: 8px;
            color: #2D3748;
            font-weight: 600;
            font-size: 14px;
        }

        .login-form input {
            width: 100%;
            padding: 14px 16px;
            border: 2px solid #E2E8F0;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .login-form input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .login-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .login-btn:disabled {
            background: #CBD5E0;
            cursor: not-allowed;
            box-shadow: none;
            transform: none;
        }

        .login-error {
            background: #FED7D7;
            color: #742A2A;
            border: 2px solid #FC8181;
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .login-info {
            background: #E6FFFA;
            color: #234E52;
            border: 2px solid #81E6D9;
            padding: 12px 16px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 13px;
        }

        .login-info strong {
            display: block;
            margin-bottom: 4px;
        }

        .user-badge {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 20px;
            background: #F7FAFC;
            border-bottom: 1px solid #E2E8F0;
        }

        .user-badge img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid #667eea;
        }

        .user-badge-info {
            flex: 1;
        }

        .user-badge-name {
            font-weight: 600;
            color: #2D3748;
            font-size: 14px;
        }

        .user-badge-role {
            font-size: 12px;
            color: #667eea;
            text-transform: uppercase;
            font-weight: 500;
        }

        .logout-btn {
            background: none;
            border: none;
            color: #E53E3E;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.2s;
        }

        .logout-btn:hover {
            background: #FED7D7;
        }

        /* ========== PANEL ADMIN ========== */
        .admin-section {
            background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%);
            border: 2px solid #F59E0B;
            border-radius: 16px;
            padding: 24px;
            margin: 20px;
            display: none;
        }

        .admin-section.visible {
            display: block;
        }

        .admin-section h2 {
            color: #92400E;
            font-size: 20px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .admin-tab {
            padding: 10px 20px;
            border: 2px solid #F59E0B;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
        }

        .admin-tab:hover {
            background: #FEF3C7;
        }

        .admin-tab.active {
            background: #F59E0B;
            color: white;
        }

        .admin-content {
            display: none;
        }

        .admin-content.active {
            display: block;
        }

        .admin-form {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .admin-form .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        .admin-form .form-group {
            margin-bottom: 16px;
        }

        .admin-form label {
            display: block;
            margin-bottom: 6px;
            color: #92400E;
            font-weight: 600;
            font-size: 13px;
        }

        .admin-form input {
            width: 100%;
            padding: 10px 14px;
            border: 2px solid #E2E8F0;
            border-radius: 8px;
            font-size: 14px;
        }

        .admin-form input:focus {
            border-color: #F59E0B;
            outline: none;
        }

        .btn-admin {
            background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-admin:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(245, 158, 11, 0.4);
        }

        .btn-admin:disabled {
            background: #CBD5E0;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .periodistas-list {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .periodista-item {
            display: flex;
            align-items: center;
            padding: 16px 20px;
            border-bottom: 1px solid #E2E8F0;
            gap: 16px;
        }

        .periodista-item:last-child {
            border-bottom: none;
        }

        .periodista-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 18px;
        }

        .periodista-info {
            flex: 1;
        }

        .periodista-nombre {
            font-weight: 600;
            color: #2D3748;
            font-size: 15px;
        }

        .periodista-email {
            font-size: 13px;
            color: #718096;
        }

        .periodista-stats {
            text-align: right;
            font-size: 13px;
            color: #718096;
        }

        .periodista-stats strong {
            color: #667eea;
            font-size: 18px;
        }

        .admin-alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 14px;
        }

        .admin-alert-success {
            background: #C6F6D5;
            color: #22543D;
            border: 1px solid #9AE6B4;
        }

        .admin-alert-error {
            background: #FED7D7;
            color: #742A2A;
            border: 1px solid #FC8181;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #718096;
        }

        .empty-state p {
            margin-top: 10px;
        }

        /* ========== OPCIONES DE FUENTE ========== */
        .source-options {
            display: flex;
            gap: 16px;
            flex-wrap: wrap;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            border: 2px solid #E2E8F0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            flex: 1;
            min-width: 200px;
        }

        .radio-option:hover {
            border-color: #667eea;
            background: #F7FAFC;
        }

        .radio-option input[type="radio"] {
            width: 18px;
            height: 18px;
            accent-color: #667eea;
        }

        .radio-option input[type="radio"]:checked + .radio-label {
            color: #667eea;
            font-weight: 600;
        }

        .radio-option:has(input:checked) {
            border-color: #667eea;
            background: #EBF4FF;
        }

        .radio-label {
            font-size: 14px;
            color: #4A5568;
        }

        #fuenteExternaFields {
            background: #FFF5F5;
            border: 2px solid #FC8181;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }

        #fuenteExternaFields .form-group {
            margin-bottom: 16px;
        }

        #fuenteExternaFields .form-group:last-child {
            margin-bottom: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
            display: none;
        }

        .header {
            background: linear-gradient(135deg, #2D3748 0%, #1A202C 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 16px;
        }

        .content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            padding: 30px;
        }

        .form-section {
            padding: 20px;
        }

        .map-section {
            position: sticky;
            top: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #2D3748;
            font-weight: 600;
            font-size: 14px;
        }

        input, textarea, select {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #E2E8F0;
            border-radius: 12px;
            font-size: 15px;
            transition: all 0.3s;
            font-family: inherit;
        }

        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        #map {
            height: 500px;
            border-radius: 12px;
            border: 2px solid #E2E8F0;
            margin-bottom: 15px;
        }

        .map-info {
            background: #F7FAFC;
            padding: 15px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .map-info p {
            margin: 5px 0;
            font-size: 14px;
            color: #4A5568;
        }

        .map-info strong {
            color: #2D3748;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 16px 32px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn:disabled {
            background: #CBD5E0;
            cursor: not-allowed;
            box-shadow: none;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-weight: 500;
            display: none;
        }

        .alert-success {
            background: #C6F6D5;
            color: #22543D;
            border: 2px solid #9AE6B4;
        }

        .alert-error {
            background: #FED7D7;
            color: #742A2A;
            border: 2px solid #FC8181;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .required {
            color: #E53E3E;
        }

        /* ========== ESTILOS PARA SUBIDA DE IMAGEN ========== */
        .image-tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
        }

        .tab-btn {
            flex: 1;
            padding: 10px 16px;
            border: 2px solid #E2E8F0;
            background: white;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            color: #4A5568;
        }

        .tab-btn:hover {
            border-color: #667eea;
            color: #667eea;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: transparent;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .file-upload-wrapper {
            position: relative;
        }

        .file-upload-wrapper input[type="file"] {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
            z-index: 2;
        }

        .file-upload-area {
            border: 2px dashed #CBD5E0;
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            background: #F7FAFC;
        }

        .file-upload-area:hover {
            border-color: #667eea;
            background: #EBF4FF;
        }

        .file-upload-area.dragover {
            border-color: #667eea;
            background: #EBF4FF;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 12px;
        }

        .file-upload-area p {
            color: #4A5568;
            font-weight: 500;
            margin-bottom: 6px;
        }

        .file-types {
            font-size: 12px;
            color: #A0AEC0;
        }

        .image-preview {
            position: relative;
            margin-top: 12px;
            border-radius: 12px;
            overflow: hidden;
            border: 2px solid #E2E8F0;
        }

        .image-preview img {
            width: 100%;
            max-height: 250px;
            object-fit: cover;
            display: block;
        }

        .remove-image {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: rgba(0,0,0,0.6);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .remove-image:hover {
            background: #E53E3E;
            transform: scale(1.1);
        }

        .image-info {
            padding: 10px 15px;
            background: #F7FAFC;
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            color: #4A5568;
        }

        .upload-progress {
            margin-top: 12px;
        }

        .progress-bar {
            height: 8px;
            background: #E2E8F0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            width: 0%;
            transition: width 0.3s ease;
            border-radius: 4px;
        }

        #progressText {
            display: block;
            text-align: center;
            font-size: 13px;
            color: #667eea;
            margin-top: 8px;
            font-weight: 500;
        }

        .url-hint {
            font-size: 12px;
            color: #A0AEC0;
            margin-top: 8px;
        }

        @media (max-width: 968px) {
            .content {
                grid-template-columns: 1fr;
            }

            .map-section {
                position: relative;
                top: 0;
            }
        }
    </style>
</head>
<body>
    <!-- ========== PANTALLA DE LOGIN ========== -->
    <div id="loginContainer" class="login-container">
        <div class="login-header">
            <h1>üîê Panel de Periodista</h1>
            <p>Inicia sesi√≥n para publicar noticias</p>
        </div>
        <div class="login-form">
            <div class="login-info">
                <strong>‚ÑπÔ∏è Acceso restringido</strong>
                Solo periodistas y administradores pueden acceder a este panel.
            </div>
            <div id="loginError" class="login-error"></div>
            <form id="loginForm">
                <div class="form-group">
                    <label for="loginEmail">Correo electr√≥nico</label>
                    <input type="email" id="loginEmail" name="email" placeholder="tu@email.com" required>
                </div>
                <div class="form-group">
                    <label for="loginPassword">Contrase√±a</label>
                    <input type="password" id="loginPassword" name="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button type="submit" class="login-btn" id="btnLogin">
                    Iniciar Sesi√≥n
                </button>
            </form>
        </div>
    </div>

    <!-- ========== PANEL DE PERIODISTA (oculto hasta login) ========== -->
    <div class="container" id="panelContainer">
        <!-- Barra de usuario logueado -->
        <div class="user-badge" id="userBadge">
            <img id="userAvatar" src="https://ui-avatars.com/api/?name=P&background=667eea&color=fff" alt="Avatar">
            <div class="user-badge-info">
                <div class="user-badge-name" id="userName">Periodista</div>
                <div class="user-badge-role" id="userRole">Reportero</div>
            </div>
            <button class="logout-btn" onclick="logout()">Cerrar sesi√≥n</button>
        </div>

        <div class="header">
            <h1>üì∞ Panel de Periodista</h1>
            <p>Publica noticias locales de Ibarra con geolocalizaci√≥n</p>
        </div>

        <!-- ========== SECCI√ìN ADMIN (solo visible para admin) ========== -->
        <div id="adminSection" class="admin-section">
            <h2>üëë Panel de Administraci√≥n</h2>

            <div class="admin-tabs">
                <button class="admin-tab active" onclick="switchAdminTab('registrar')">
                    ‚ûï Registrar Periodista
                </button>
                <button class="admin-tab" onclick="switchAdminTab('lista')">
                    üìã Ver Periodistas
                </button>
            </div>

            <!-- Tab: Registrar Periodista -->
            <div id="admin-registrar" class="admin-content active">
                <div id="adminAlert" class="admin-alert" style="display: none;"></div>
                <form id="registrarPeriodistaForm" class="admin-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pNombre">Nombre *</label>
                            <input type="text" id="pNombre" name="nombre" placeholder="Juan" required>
                        </div>
                        <div class="form-group">
                            <label for="pApellido">Apellido</label>
                            <input type="text" id="pApellido" name="apellido" placeholder="P√©rez">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pEmail">Email *</label>
                            <input type="email" id="pEmail" name="email" placeholder="periodista@email.com" required>
                        </div>
                        <div class="form-group">
                            <label for="pTelefono">Tel√©fono</label>
                            <input type="tel" id="pTelefono" name="telefono" placeholder="0999999999">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="pPassword">Contrase√±a *</label>
                        <input type="password" id="pPassword" name="password" placeholder="M√≠nimo 6 caracteres" required minlength="6">
                    </div>
                    <button type="submit" class="btn-admin" id="btnRegistrarPeriodista">
                        ‚ûï Registrar Periodista
                    </button>
                </form>
            </div>

            <!-- Tab: Lista de Periodistas -->
            <div id="admin-lista" class="admin-content">
                <div id="periodistasContainer" class="periodistas-list">
                    <div class="empty-state">
                        <p>Cargando periodistas...</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="content">
            <!-- FORMULARIO -->
            <div class="form-section">
                <div id="alert" class="alert"></div>

                <form id="noticiaForm">
                    <div class="form-group">
                        <label for="titulo">
                            T√≠tulo de la Noticia <span class="required">*</span>
                        </label>
                        <input
                            type="text"
                            id="titulo"
                            name="titulo"
                            placeholder="Ej: Inauguraci√≥n del nuevo parque en El Sagrario"
                            required
                            maxlength="200"
                        >
                    </div>

                    <div class="form-group">
                        <label for="descripcion">
                            Resumen <span class="required">*</span>
                        </label>
                        <textarea
                            id="descripcion"
                            name="descripcion"
                            placeholder="Breve resumen de la noticia (1-2 oraciones)"
                            required
                            maxlength="300"
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label for="contenido">
                            Contenido Completo <span class="required">*</span>
                        </label>
                        <textarea
                            id="contenido"
                            name="contenido"
                            placeholder="Escribe el contenido completo de la noticia..."
                            required
                            style="min-height: 200px;"
                        ></textarea>
                    </div>

                    <!-- FUENTE DE LA NOTICIA -->
                    <div class="form-group">
                        <label>Fuente de la Noticia <span class="required">*</span></label>
                        <div class="source-options">
                            <label class="radio-option">
                                <input type="radio" name="tipoFuente" value="propia" checked onchange="toggleFuenteExterna()">
                                <span class="radio-label">üìù Contenido propio (yo soy el autor)</span>
                            </label>
                            <label class="radio-option">
                                <input type="radio" name="tipoFuente" value="externa" onchange="toggleFuenteExterna()">
                                <span class="radio-label">üîó Contenido de otra fuente</span>
                            </label>
                        </div>
                    </div>

                    <!-- Campos para fuente externa (ocultos por defecto) -->
                    <div id="fuenteExternaFields" style="display: none;">
                        <div class="form-group">
                            <label for="autorOriginal">
                                Autor Original <span class="required">*</span>
                            </label>
                            <input
                                type="text"
                                id="autorOriginal"
                                name="autorOriginal"
                                placeholder="Nombre del autor o medio de comunicaci√≥n"
                            >
                        </div>
                        <div class="form-group">
                            <label for="urlFuente">
                                URL de la Fuente <span class="required">*</span>
                            </label>
                            <input
                                type="url"
                                id="urlFuente"
                                name="urlFuente"
                                placeholder="https://ejemplo.com/noticia-original"
                            >
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="citaDestacada">
                            Cita Destacada (opcional)
                        </label>
                        <textarea
                            id="citaDestacada"
                            name="citaDestacada"
                            placeholder="Cita o frase destacada de la noticia en estilo quote..."
                            maxlength="500"
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label for="impactoComunitario">
                            Impacto Comunitario (opcional)
                        </label>
                        <textarea
                            id="impactoComunitario"
                            name="impactoComunitario"
                            placeholder="Describe el impacto que tendr√° esta noticia en la comunidad..."
                            maxlength="500"
                        ></textarea>
                    </div>

                    <div class="form-group">
                        <label for="hashtags">
                            Hashtags (opcional)
                        </label>
                        <input
                            type="text"
                            id="hashtags"
                            name="hashtags"
                            placeholder="Planificaci√≥nUrbana, ConcejoMunicipal (separados por coma)"
                            maxlength="200"
                        >
                    </div>

                    <div class="form-group">
                        <label for="categoria">
                            Categor√≠a <span class="required">*</span>
                        </label>
                        <select id="categoria" name="categoria" required>
                            <option value="">-- Selecciona una categor√≠a --</option>
                            <option value="1">Pol√≠tica</option>
                            <option value="2">Econom√≠a</option>
                            <option value="3">Cultura</option>
                            <option value="4">Deportes</option>
                            <option value="5">Educaci√≥n</option>
                            <option value="6">Salud</option>
                            <option value="7">Seguridad</option>
                            <option value="8">Medio Ambiente</option>
                            <option value="9">Turismo</option>
                            <option value="10">Tecnolog√≠a</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="imagenFile">
                            Imagen de la Noticia (opcional)
                        </label>

                        <!-- Tabs para elegir m√©todo de imagen -->
                        <div class="image-tabs">
                            <button type="button" class="tab-btn active" data-tab="firebase" onclick="switchImageTab('firebase')">
                                üî• Firebase Storage
                            </button>
                            <button type="button" class="tab-btn" data-tab="drive" onclick="switchImageTab('drive')">
                                üìÅ Google Drive
                            </button>
                        </div>

                        <!-- Tab: Firebase Storage -->
                        <div id="tab-firebase" class="tab-content active">
                            <div class="file-upload-wrapper">
                                <input
                                    type="file"
                                    id="imagenFile"
                                    name="imagenFile"
                                    accept="image/jpeg,image/png,image/gif,image/webp"
                                    onchange="previewImage(this, 'firebase')"
                                >
                                <div class="file-upload-area" id="firebaseUploadArea" onclick="document.getElementById('imagenFile').click()">
                                    <div class="upload-icon">üî•</div>
                                    <p>Subir a Firebase Storage</p>
                                    <span class="file-types">JPG, PNG, GIF, WebP (m√°x. 5MB)</span>
                                </div>
                            </div>
                            <div id="imagePreviewFirebase" class="image-preview" style="display: none;">
                                <img id="previewImgFirebase" src="" alt="Preview">
                                <button type="button" class="remove-image" onclick="removeImage('firebase')">‚úï</button>
                                <div class="image-info">
                                    <span id="imageNameFirebase"></span>
                                    <span id="imageSizeFirebase"></span>
                                </div>
                            </div>
                            <div id="uploadProgressFirebase" class="upload-progress" style="display: none;">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progressFillFirebase"></div>
                                </div>
                                <span id="progressTextFirebase">Subiendo a Firebase...</span>
                            </div>
                        </div>

                        <!-- Tab: Google Drive -->
                        <div id="tab-drive" class="tab-content" style="display: none;">
                            <div class="file-upload-wrapper">
                                <input
                                    type="file"
                                    id="imagenFileDrive"
                                    name="imagenFileDrive"
                                    accept="image/jpeg,image/png,image/gif,image/webp"
                                    onchange="previewImage(this, 'drive')"
                                >
                                <div class="file-upload-area" id="driveUploadArea" onclick="document.getElementById('imagenFileDrive').click()">
                                    <div class="upload-icon">üìÅ</div>
                                    <p>Subir a Google Drive</p>
                                    <span class="file-types">JPG, PNG, GIF, WebP (m√°x. 10MB)</span>
                                </div>
                            </div>
                            <div id="imagePreviewDrive" class="image-preview" style="display: none;">
                                <img id="previewImgDrive" src="" alt="Preview">
                                <button type="button" class="remove-image" onclick="removeImage('drive')">‚úï</button>
                                <div class="image-info">
                                    <span id="imageNameDrive"></span>
                                    <span id="imageSizeDrive"></span>
                                </div>
                            </div>
                            <div id="uploadProgressDrive" class="upload-progress" style="display: none;">
                                <div class="progress-bar">
                                    <div class="progress-fill" id="progressFillDrive"></div>
                                </div>
                                <span id="progressTextDrive">Subiendo a Google Drive...</span>
                            </div>
                        </div>

                        <!-- URL de imagen ya subida (hidden) -->
                        <input type="hidden" id="imagenUrl" name="imagenUrl">
                    </div>

                    <div class="form-group">
                        <label for="ubicacionTexto">
                            Ubicaci√≥n (Texto) <span class="required">*</span>
                        </label>
                        <input
                            type="text"
                            id="ubicacionTexto"
                            name="ubicacionTexto"
                            placeholder="Ej: Parque Pedro Moncayo, Centro de Ibarra"
                            required
                        >
                    </div>

                    <div class="loading" id="loading">
                        <div class="spinner"></div>
                        <p style="margin-top: 10px; color: #4A5568;">Publicando noticia...</p>
                    </div>

                    <button type="submit" class="btn" id="btnPublicar">
                        üì§ Publicar Noticia
                    </button>
                </form>
            </div>

            <!-- MAPA -->
            <div class="map-section">
                <div class="form-group">
                    <label>
                        üìç Selecciona la ubicaci√≥n en el mapa <span class="required">*</span>
                    </label>
                    <p style="font-size: 13px; color: #718096; margin-bottom: 10px;">
                        Haz clic en el mapa para marcar la ubicaci√≥n de la noticia
                    </p>
                </div>

                <div id="map"></div>

                <div class="map-info">
                    <p><strong>üìç Coordenadas seleccionadas:</strong></p>
                    <p id="coordenadas">Haz clic en el mapa para seleccionar</p>
                    <p id="ubicacion" style="margin-top: 8px; font-style: italic;"></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Google Maps API -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBz76Xsfoq8DJShdLES6ZZyhC4zeVWoPck"></script>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        // ========================================
        // CONFIGURACI√ìN FIREBASE
        // ========================================
        const firebaseConfig = {
            apiKey: "AIzaSyA_JQPd_t9jwb9Kw39muih7P4Ux55u_U30",
            authDomain: "noticiaslocalesibarra.firebaseapp.com",
            projectId: "noticiaslocalesibarra",
            storageBucket: "noticiaslocalesibarra.firebasestorage.app",
            messagingSenderId: "166115544761",
            appId: "1:166115544761:android:b40030a0cf929db4b19568"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);
        const storage = firebase.storage();
    </script>

    <script>
        // ========================================
        // CONFIGURACI√ìN
        // ========================================
        const API_URL = window.location.origin; // Usa la misma URL del backend

        // Coordenadas de Ibarra (centro)
        const IBARRA_CENTER = { lat: 0.3476, lng: -78.1223 };

        // ========================================
        // VARIABLES GLOBALES
        // ========================================
        let map;
        let marker;
        let selectedLocation = null;
        let currentUser = null;
        let selectedImageFile = null;
        let selectedImageType = null; // 'firebase' o 'drive'
        let uploadedImageUrl = null;

        // ========================================
        // FUNCI√ìN FUENTE DE NOTICIA
        // ========================================
        function toggleFuenteExterna() {
            const tipoFuente = document.querySelector('input[name="tipoFuente"]:checked').value;
            const fuenteFields = document.getElementById('fuenteExternaFields');

            if (tipoFuente === 'externa') {
                fuenteFields.style.display = 'block';
                document.getElementById('autorOriginal').required = true;
                document.getElementById('urlFuente').required = true;
            } else {
                fuenteFields.style.display = 'none';
                document.getElementById('autorOriginal').required = false;
                document.getElementById('urlFuente').required = false;
                document.getElementById('autorOriginal').value = '';
                document.getElementById('urlFuente').value = '';
            }
        }

        // ========================================
        // SISTEMA DE LOGIN
        // ========================================

        // Verificar si hay sesi√≥n guardada al cargar
        document.addEventListener('DOMContentLoaded', function() {
            checkSession();
        });

        function checkSession() {
            const savedUser = localStorage.getItem('geonews_user');
            const savedToken = localStorage.getItem('geonews_token');

            if (savedUser && savedToken) {
                try {
                    currentUser = JSON.parse(savedUser);
                    showPanel();
                } catch (e) {
                    logout();
                }
            }
        }

        // Manejar formulario de login
        document.getElementById('loginForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showLoginError('Por favor completa todos los campos');
                return;
            }

            // Deshabilitar bot√≥n
            const btnLogin = document.getElementById('btnLogin');
            btnLogin.disabled = true;
            btnLogin.textContent = 'Iniciando sesi√≥n...';

            try {
                const response = await fetch(`${API_URL}/api/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ email, password })
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    // Guardar sesi√≥n
                    currentUser = result.usuario;
                    localStorage.setItem('geonews_user', JSON.stringify(result.usuario));
                    localStorage.setItem('geonews_token', result.token);

                    // Mostrar panel
                    showPanel();
                } else {
                    showLoginError(result.detail || 'Error al iniciar sesi√≥n');
                }
            } catch (error) {
                console.error('Error de login:', error);
                showLoginError('Error de conexi√≥n. Verifica que el servidor est√© activo.');
            } finally {
                btnLogin.disabled = false;
                btnLogin.textContent = 'Iniciar Sesi√≥n';
            }
        });

        function showLoginError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';

            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }

        function showPanel() {
            // Ocultar login
            document.getElementById('loginContainer').style.display = 'none';

            // Mostrar panel
            document.getElementById('panelContainer').style.display = 'block';

            // Actualizar info de usuario
            if (currentUser) {
                const nombre = `${currentUser.nombre || ''} ${currentUser.apellido || ''}`.trim() || 'Periodista';
                document.getElementById('userName').textContent = nombre;
                document.getElementById('userRole').textContent =
                    currentUser.tipoUsuario === 'admin' ? 'Administrador' : 'Periodista';

                // Avatar
                if (currentUser.fotoPerfil) {
                    document.getElementById('userAvatar').src = currentUser.fotoPerfil;
                } else {
                    const initials = nombre.split(' ').map(n => n[0]).join('').substring(0, 2);
                    document.getElementById('userAvatar').src =
                        `https://ui-avatars.com/api/?name=${encodeURIComponent(initials)}&background=667eea&color=fff`;
                }

                // Mostrar secci√≥n de admin solo si es administrador
                if (currentUser.tipoUsuario === 'admin') {
                    document.getElementById('adminSection').classList.add('visible');
                } else {
                    document.getElementById('adminSection').classList.remove('visible');
                }
            }

            // Inicializar mapa despu√©s de mostrar el panel
            setTimeout(() => {
                if (typeof google !== 'undefined' && !map) {
                    initMap();
                }
            }, 100);
        }

        function logout() {
            // Limpiar sesi√≥n
            localStorage.removeItem('geonews_user');
            localStorage.removeItem('geonews_token');
            currentUser = null;

            // Mostrar login
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('panelContainer').style.display = 'none';

            // Ocultar secci√≥n admin
            document.getElementById('adminSection').classList.remove('visible');

            // Limpiar formulario de login
            document.getElementById('loginForm').reset();
        }

        // ========================================
        // FUNCIONES DE ADMINISTRACI√ìN
        // ========================================

        function switchAdminTab(tab) {
            // Actualizar tabs
            document.querySelectorAll('.admin-tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');

            // Mostrar contenido
            document.querySelectorAll('.admin-content').forEach(c => c.classList.remove('active'));
            document.getElementById(`admin-${tab}`).classList.add('active');

            // Cargar lista si es necesario
            if (tab === 'lista') {
                cargarPeriodistas();
            }
        }

        function showAdminAlert(message, type) {
            const alertDiv = document.getElementById('adminAlert');
            alertDiv.textContent = message;
            alertDiv.className = `admin-alert admin-alert-${type}`;
            alertDiv.style.display = 'block';

            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
        }

        // Manejar formulario de registro de periodista
        document.getElementById('registrarPeriodistaForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const nombre = document.getElementById('pNombre').value.trim();
            const apellido = document.getElementById('pApellido').value.trim();
            const email = document.getElementById('pEmail').value.trim();
            const telefono = document.getElementById('pTelefono').value.trim();
            const password = document.getElementById('pPassword').value;

            if (!nombre || !email || !password) {
                showAdminAlert('Por favor completa los campos requeridos', 'error');
                return;
            }

            if (password.length < 6) {
                showAdminAlert('La contrase√±a debe tener al menos 6 caracteres', 'error');
                return;
            }

            const btn = document.getElementById('btnRegistrarPeriodista');
            btn.disabled = true;
            btn.textContent = 'Registrando...';

            try {
                const response = await fetch(`${API_URL}/api/admin/registrar-periodista`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        email,
                        password,
                        nombre,
                        apellido: apellido || null,
                        telefono: telefono || null
                    })
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    showAdminAlert(`‚úÖ Periodista "${nombre}" registrado exitosamente`, 'success');
                    document.getElementById('registrarPeriodistaForm').reset();
                } else {
                    showAdminAlert(result.detail || 'Error al registrar periodista', 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAdminAlert('Error de conexi√≥n', 'error');
            } finally {
                btn.disabled = false;
                btn.textContent = '‚ûï Registrar Periodista';
            }
        });

        async function cargarPeriodistas() {
            const container = document.getElementById('periodistasContainer');
            container.innerHTML = '<div class="empty-state"><p>Cargando periodistas...</p></div>';

            try {
                const response = await fetch(`${API_URL}/api/admin/periodistas`);
                const result = await response.json();

                if (response.ok && result.success) {
                    if (result.periodistas.length === 0) {
                        container.innerHTML = `
                            <div class="empty-state">
                                <p>üë§ No hay periodistas registrados</p>
                                <p>Registra el primer periodista en la pesta√±a anterior</p>
                            </div>
                        `;
                    } else {
                        container.innerHTML = result.periodistas.map(p => {
                            const initials = p.nombre.split(' ').map(n => n[0]).join('').substring(0, 2).toUpperCase();
                            return `
                                <div class="periodista-item">
                                    <div class="periodista-avatar">${initials}</div>
                                    <div class="periodista-info">
                                        <div class="periodista-nombre">${p.nombre}</div>
                                        <div class="periodista-email">${p.email}</div>
                                    </div>
                                    <div class="periodista-stats">
                                        <strong>${p.noticiasPublicadas}</strong><br>
                                        noticias
                                    </div>
                                </div>
                            `;
                        }).join('');
                    }
                } else {
                    container.innerHTML = '<div class="empty-state"><p>Error al cargar periodistas</p></div>';
                }
            } catch (error) {
                console.error('Error:', error);
                container.innerHTML = '<div class="empty-state"><p>Error de conexi√≥n</p></div>';
            }
        }

        // ========================================
        // INICIALIZAR MAPA
        // ========================================
        function initMap() {
            // Crear mapa centrado en Ibarra
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 14,
                center: IBARRA_CENTER,
                mapTypeControl: true,
                streetViewControl: false,
                fullscreenControl: true,
                styles: [
                    {
                        featureType: 'poi',
                        elementType: 'labels',
                        stylers: [{ visibility: 'on' }]
                    }
                ]
            });

            // Click en el mapa para seleccionar ubicaci√≥n
            map.addListener('click', (event) => {
                setLocation(event.latLng);
            });

            // Marcador inicial en el centro
            marker = new google.maps.Marker({
                map: map,
                position: IBARRA_CENTER,
                draggable: true,
                title: 'Ubicaci√≥n de la noticia',
                animation: google.maps.Animation.DROP
            });

            // Actualizar ubicaci√≥n al arrastrar marcador
            marker.addListener('dragend', (event) => {
                setLocation(event.latLng);
            });

            // Establecer ubicaci√≥n inicial
            setLocation(IBARRA_CENTER);
        }

        // ========================================
        // ESTABLECER UBICACI√ìN
        // ========================================
        function setLocation(latLng) {
            const lat = typeof latLng.lat === 'function' ? latLng.lat() : latLng.lat;
            const lng = typeof latLng.lng === 'function' ? latLng.lng() : latLng.lng;

            selectedLocation = { lat, lng };

            // Mover marcador
            marker.setPosition(selectedLocation);

            // Actualizar texto de coordenadas
            document.getElementById('coordenadas').innerHTML =
                `Latitud: <strong>${lat.toFixed(6)}</strong>, Longitud: <strong>${lng.toFixed(6)}</strong>`;

            // Obtener nombre del lugar (opcional, requiere Geocoding API)
            document.getElementById('ubicacion').textContent =
                'üìå Ubicaci√≥n seleccionada correctamente';
        }

        // ========================================
        // MANEJO DEL FORMULARIO
        // ========================================
        document.getElementById('noticiaForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            // Validar que se haya seleccionado ubicaci√≥n
            if (!selectedLocation) {
                showAlert('Por favor, selecciona una ubicaci√≥n en el mapa', 'error');
                return;
            }

            // Obtener URL de imagen
            let imagenUrlFinal = null;

            // Verificar si hay un archivo seleccionado para subir
            if (selectedImageFile && selectedImageType) {
                // Mostrar loading
                document.getElementById('loading').style.display = 'block';
                document.getElementById('btnPublicar').disabled = true;

                try {
                    // Subir imagen seg√∫n el tipo seleccionado
                    if (selectedImageType === 'firebase') {
                        imagenUrlFinal = await uploadImageToFirebase(selectedImageFile);
                        console.log('Imagen subida a Firebase:', imagenUrlFinal);
                    } else if (selectedImageType === 'drive') {
                        imagenUrlFinal = await uploadImageToDrive(selectedImageFile);
                        console.log('Imagen subida a Google Drive:', imagenUrlFinal);
                    }
                } catch (error) {
                    console.error('Error al subir imagen:', error);
                    showAlert('Error al subir la imagen. Intenta de nuevo.', 'error');
                    document.getElementById('loading').style.display = 'none';
                    document.getElementById('btnPublicar').disabled = false;
                    return;
                }
            } else {
                // Usar URL guardada si existe
                imagenUrlFinal = document.getElementById('imagenUrl').value.trim() || null;
            }

            // Obtener tipo de fuente
            const tipoFuente = document.querySelector('input[name="tipoFuente"]:checked').value;
            const esContenidoPropio = tipoFuente === 'propia';

            // Obtener autor y fuente
            let autorNombre = '';
            let urlFuente = null;

            if (esContenidoPropio && currentUser) {
                // Si es contenido propio, usar el nombre del periodista logueado
                autorNombre = `${currentUser.nombre || ''} ${currentUser.apellido || ''}`.trim();
            } else {
                // Si es de otra fuente, usar los campos ingresados
                autorNombre = document.getElementById('autorOriginal').value.trim();
                urlFuente = document.getElementById('urlFuente').value.trim() || null;
            }

            // Obtener datos del formulario
            const formData = {
                titulo: document.getElementById('titulo').value.trim(),
                descripcion: document.getElementById('descripcion').value.trim(),
                contenido: document.getElementById('contenido').value.trim(),
                citaDestacada: document.getElementById('citaDestacada').value.trim() || null,
                impactoComunitario: document.getElementById('impactoComunitario').value.trim() || null,
                hashtags: document.getElementById('hashtags').value.trim() || null,
                categoriaId: document.getElementById('categoria').value,
                imagenUrl: imagenUrlFinal,
                ubicacionTexto: document.getElementById('ubicacionTexto').value.trim(),
                latitud: selectedLocation.lat,
                longitud: selectedLocation.lng,
                destacada: false,
                activa: true,
                // Campos de autor√≠a
                autorNombre: autorNombre,
                autorId: esContenidoPropio && currentUser ? currentUser.id : null,
                esContenidoPropio: esContenidoPropio,
                urlFuente: urlFuente
            };

            // Validaciones
            if (!formData.titulo || !formData.descripcion || !formData.contenido) {
                showAlert('Por favor, completa todos los campos requeridos', 'error');
                return;
            }

            if (!formData.categoriaId) {
                showAlert('Por favor, selecciona una categor√≠a', 'error');
                return;
            }

            // Validar fuente externa
            if (!esContenidoPropio) {
                if (!autorNombre) {
                    showAlert('Por favor, ingresa el autor original de la noticia', 'error');
                    return;
                }
                if (!urlFuente) {
                    showAlert('Por favor, ingresa la URL de la fuente original', 'error');
                    return;
                }
            }

            // Mostrar loading
            document.getElementById('loading').style.display = 'block';
            document.getElementById('btnPublicar').disabled = true;

            try {
                // Enviar a la API
                const response = await fetch(`${API_URL}/noticias`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });

                const result = await response.json();

                if (response.ok) {
                    showAlert('‚úÖ ¬°Noticia publicada exitosamente!', 'success');

                    // Limpiar formulario
                    document.getElementById('noticiaForm').reset();

                    // Resetear im√°genes
                    removeImage('firebase');
                    removeImage('drive');
                    switchImageTab('firebase');

                    // Resetear mapa a centro
                    setLocation(IBARRA_CENTER);
                    map.setCenter(IBARRA_CENTER);

                    // Scroll al inicio
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                } else {
                    showAlert(`Error: ${result.detail || 'No se pudo publicar la noticia'}`, 'error');
                }
            } catch (error) {
                console.error('Error:', error);
                showAlert('‚ùå Error de conexi√≥n. Verifica que el servidor est√© activo.', 'error');
            } finally {
                // Ocultar loading
                document.getElementById('loading').style.display = 'none';
                document.getElementById('btnPublicar').disabled = false;
            }
        });

        // ========================================
        // MOSTRAR ALERTAS
        // ========================================
        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.textContent = message;
            alert.className = `alert alert-${type}`;
            alert.style.display = 'block';

            // Auto-ocultar despu√©s de 5 segundos
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // ========================================
        // FUNCIONES DE IMAGEN
        // ========================================

        function switchImageTab(tab) {
            // Actualizar tabs activos
            document.querySelectorAll('.image-tabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.tab === tab) {
                    btn.classList.add('active');
                }
            });

            // Mostrar/ocultar contenido
            document.getElementById('tab-firebase').style.display = tab === 'firebase' ? 'block' : 'none';
            document.getElementById('tab-drive').style.display = tab === 'drive' ? 'block' : 'none';

            // Limpiar al cambiar de tab
            if (tab === 'firebase') {
                removeImage('drive');
            } else {
                removeImage('firebase');
            }
        }

        function previewImage(input, type) {
            const file = input.files[0];

            if (!file) return;

            // Validar tipo de archivo
            const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {
                showAlert('Por favor selecciona una imagen v√°lida (JPG, PNG, GIF, WebP)', 'error');
                input.value = '';
                return;
            }

            // Validar tama√±o
            const maxSize = type === 'drive' ? 10 * 1024 * 1024 : 5 * 1024 * 1024;
            if (file.size > maxSize) {
                showAlert(`La imagen es muy grande. El tama√±o m√°ximo es ${type === 'drive' ? '10' : '5'}MB`, 'error');
                input.value = '';
                return;
            }

            selectedImageFile = file;
            selectedImageType = type;

            // Mostrar preview seg√∫n el tipo
            const suffix = type === 'firebase' ? 'Firebase' : 'Drive';
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById(`previewImg${suffix}`).src = e.target.result;
                document.getElementById(`imagePreview${suffix}`).style.display = 'block';
                document.getElementById(`imageName${suffix}`).textContent = file.name;
                document.getElementById(`imageSize${suffix}`).textContent = formatFileSize(file.size);
                document.getElementById(`${type}UploadArea`).style.display = 'none';
            };
            reader.readAsDataURL(file);
        }

        function removeImage(type) {
            if (!type) type = selectedImageType || 'firebase';

            const suffix = type === 'firebase' ? 'Firebase' : 'Drive';
            const inputId = type === 'firebase' ? 'imagenFile' : 'imagenFileDrive';

            document.getElementById(inputId).value = '';
            document.getElementById(`previewImg${suffix}`).src = '';
            document.getElementById(`imagePreview${suffix}`).style.display = 'none';
            document.getElementById(`${type}UploadArea`).style.display = 'block';
            document.getElementById(`uploadProgress${suffix}`).style.display = 'none';

            if (selectedImageType === type) {
                selectedImageFile = null;
                selectedImageType = null;
                uploadedImageUrl = null;
                document.getElementById('imagenUrl').value = '';
            }
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        async function uploadImageToFirebase(file) {
            return new Promise((resolve, reject) => {
                // Crear nombre √∫nico para el archivo
                const timestamp = Date.now();
                const randomId = Math.random().toString(36).substring(2, 8);
                const extension = file.name.split('.').pop();
                const fileName = `noticias/${timestamp}_${randomId}.${extension}`;

                // Referencia al storage
                const storageRef = storage.ref(fileName);

                // Subir archivo
                const uploadTask = storageRef.put(file);

                // Mostrar barra de progreso
                document.getElementById('uploadProgressFirebase').style.display = 'block';

                // Monitorear progreso
                uploadTask.on('state_changed',
                    (snapshot) => {
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        document.getElementById('progressFillFirebase').style.width = progress + '%';
                        document.getElementById('progressTextFirebase').textContent = `Subiendo a Firebase... ${Math.round(progress)}%`;
                    },
                    (error) => {
                        console.error('Error al subir imagen:', error);
                        document.getElementById('uploadProgressFirebase').style.display = 'none';
                        reject(error);
                    },
                    async () => {
                        // Obtener URL de descarga
                        try {
                            const downloadURL = await uploadTask.snapshot.ref.getDownloadURL();
                            document.getElementById('progressTextFirebase').textContent = '‚úÖ Imagen subida a Firebase';
                            setTimeout(() => {
                                document.getElementById('uploadProgressFirebase').style.display = 'none';
                            }, 2000);
                            resolve(downloadURL);
                        } catch (error) {
                            reject(error);
                        }
                    }
                );
            });
        }

        async function uploadImageToDrive(file) {
            // Mostrar barra de progreso
            document.getElementById('uploadProgressDrive').style.display = 'block';
            document.getElementById('progressFillDrive').style.width = '30%';
            document.getElementById('progressTextDrive').textContent = 'Subiendo a Google Drive...';

            try {
                const formData = new FormData();
                formData.append('file', file);

                const response = await fetch(`${API_URL}/api/upload/drive`, {
                    method: 'POST',
                    body: formData
                });

                document.getElementById('progressFillDrive').style.width = '80%';

                const result = await response.json();

                if (response.ok && result.success) {
                    document.getElementById('progressFillDrive').style.width = '100%';
                    document.getElementById('progressTextDrive').textContent = '‚úÖ Imagen subida a Google Drive';
                    setTimeout(() => {
                        document.getElementById('uploadProgressDrive').style.display = 'none';
                    }, 2000);
                    return result.url;
                } else {
                    throw new Error(result.detail || 'Error al subir a Google Drive');
                }
            } catch (error) {
                document.getElementById('uploadProgressDrive').style.display = 'none';
                throw error;
            }
        }

        // Drag and Drop
        document.addEventListener('DOMContentLoaded', function() {
            const uploadArea = document.querySelector('.file-upload-area');

            if (uploadArea) {
                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, preventDefaults, false);
                });

                function preventDefaults(e) {
                    e.preventDefault();
                    e.stopPropagation();
                }

                ['dragenter', 'dragover'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, () => {
                        uploadArea.classList.add('dragover');
                    }, false);
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    uploadArea.addEventListener(eventName, () => {
                        uploadArea.classList.remove('dragover');
                    }, false);
                });

                uploadArea.addEventListener('drop', (e) => {
                    const dt = e.dataTransfer;
                    const files = dt.files;
                    if (files.length > 0) {
                        document.getElementById('imagenFile').files = files;
                        previewImage(document.getElementById('imagenFile'));
                    }
                }, false);
            }
        });

        // ========================================
        // INICIALIZAR AL CARGAR LA P√ÅGINA
        // ========================================
        // El mapa se inicializa desde showPanel() despu√©s del login exitoso
        // window.onload = initMap;  // Deshabilitado - el mapa se inicia despu√©s del login
    </script>
</body>
</html>
